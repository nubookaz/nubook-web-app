import{w as G,r as i,j as a}from"./app-d6201cb1.js";const L=({videoProjectDetails:o,setPosterImage:p,setSelectionError:A,updateProjectAssets:h,posterImagePreview:d,handlePosterImageChange:I})=>{const{createMedia:g}=G(),[v,m]=i.useState(d),[N,u]=i.useState(!1),[c,f]=i.useState(!1),[C,E]=i.useState(0),[x,y]=i.useState(0),[w,b]=i.useState(""),S=10;i.useEffect(()=>{const s=setInterval(()=>{E(e=>(e+1)%S)},5e3);return()=>clearInterval(s)},[]),i.useEffect(()=>{let s=null;return c?s=setInterval(()=>{y(e=>e<100?e+1:(clearInterval(s),100))},100):y(0),()=>s&&clearInterval(s)},[c]);const k=async s=>{const e=s.target.files[0];if(e){const t=URL.createObjectURL(e);m(t),I(t);const n=new FormData;n.append("media",e),o.id&&n.append("project_id",o.id);const r=new Image;r.onload=async()=>{n.append("dimensions",JSON.stringify({width:r.width,height:r.height})),n.append("media_type",e.type),n.append("size",e.size),n.append("ai_generated",!1);try{const l=await g(n);p({poster:e,dimensions:{width:r.width,height:r.height},media_type:e.type,size:e.size,ai_generated:!1,media_path:l.media_path}),h(l.media_path)}catch(l){console.error("Error while uploading the image: ",l)}},r.src=t}},j=()=>{document.getElementById("fileInput").click()},_=i.useCallback(async s=>{f(!0);try{const e=await fetch("/api/media/generateAiImage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:s})});if(e.ok){const t=await e.json(),n={project_id:o.id,media_path:t.url,media_type:t.type,size:t.size,dimensions:JSON.stringify({width:t.width,height:t.height}),ai_generated:!0};m(`/storage/${t.media_path}`),p({poster:t.media_path,dimensions:{width:t.width,height:t.height},media_type:t.type,size:t.size,ai_generated:!0,media_path:`/storage/${t.media_path}`}),h(`/storage/${t.media_path}`)}else throw new Error("Failed to generate AI poster")}catch(e){console.error("Error generating AI poster:",e)}finally{f(!1)}},[g,m,p,h,o]),z=i.useCallback(()=>{const{projectName:s,primaryGenre:e,secondaryGenre:t,viewerRating:n,projectDescription:r}=o;if(!s||!e||!n||!r||t===void 0){b("Please fill out the entire form before generating the AI image.");return}b("");const l=`Create an image for '${s}', a ${e} ${t} movie rated ${n}. Description: ${r}.`;l.length>1e3&&(l=l.substring(0,1e3)),_(l)},[_,o]),$=()=>{u(!0)},M=()=>{u(!1)};i.useEffect(()=>{d&&m(d)},[d]);const O=`/images/movie_posters/movie_poster_${C+1}.jpg`;return a.jsxs("div",{className:"relative w-full",children:[a.jsx("input",{type:"file",id:"fileInput",accept:".png, .jpg, .jpeg",onChange:k,style:{display:"none"}}),a.jsx("label",{className:"block text-gray-700 text-sm text-center w-full font-bold mb-2",htmlFor:"projectDescription",children:"Project Poster"}),a.jsxs("div",{className:"mt-4 mb-6 w-full h-auto max-w-[14rem] mx-auto relative cursor-pointer",onMouseOver:$,onMouseOut:M,onClick:j,children:[N&&a.jsxs("div",{className:"absolute text-center m-auto h-full duration-500 transition-all w-full",children:[a.jsx("div",{className:"w-full h-full bg-slate-700/75 absolute z-30"}),a.jsx("p",{className:"absolute z-40 text-white top-[50%] -translate-y-2/4 px-6",children:"Click here to upload or drag and drop an image"})]}),c&&a.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-50 flex justify-center items-center",children:a.jsxs("div",{children:[x,"% Loading... "]})}),a.jsx("img",{src:v||O,alt:"Preview",className:"w-full h-auto h-full max-h-[26rem] rounded-md w-[14rem]"})]}),w&&a.jsx("p",{className:"text-red-500 mt-2",children:w}),a.jsxs("div",{className:"items-center justify-center w-full flex flex-row gap-4",children:[a.jsx("button",{onClick:j,className:"mt-2 px-4 py-2 bg-blue-500 text-white rounded",children:"Upload Image"}),a.jsx("button",{onClick:z,disabled:c,className:"mt-2 ml-2 px-4 py-2 bg-green-500 text-white rounded",children:c?`${x}% Generating...`:"Generate AI Image"})]})]})};export{L as default};
