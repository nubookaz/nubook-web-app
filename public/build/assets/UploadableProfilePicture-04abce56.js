import{u as S,r as a,j as s}from"./app-d6201cb1.js";import{u as k}from"./index-2fa57b8b.js";import"./index-cbb8f8c7.js";const D={display:"inline-flex",borderRadius:2,border:"1px solid #eaeaea",marginBottom:8,marginRight:8,width:100,height:100,padding:4,boxSizing:"border-box"},N={display:"flex",minWidth:0,overflow:"hidden"},$={display:"block",width:"auto",height:"100%"};function _({onClick:T,className:I,isUploadable:d}){const{user:c}=S(),[v,g]=a.useState(null),[z,p]=a.useState(!0),[C,u]=a.useState(0),[b,U]=a.useState(12),[m,j]=a.useState([]),[f,n]=a.useState("");a.useEffect(()=>{axios.get(route("profile.get-image")).then(e=>{const{imageUrl:r,lastUpdateTimestamp:t,imagesCount:o}=e.data;g(r!==!1?r:null),u(t),U(o||12),p(!1)}).catch(e=>{console.error(e),p(!1)})},[]),a.useEffect(()=>{const e=setInterval(()=>{localStorage.setItem("imageIndex",h()),u(Date.now())},216e5);return()=>clearInterval(e)},[]);const h=()=>Math.floor(Math.random()*b)+1;let i=localStorage.getItem("imageIndex");i||(i=h(),localStorage.setItem("imageIndex",i));const w=`/images/profile_images/profile_image_${i}.svg`,{getRootProps:x,getInputProps:y}=k({accept:{"image/jpeg":[],"image/png":[],"image/jpg":[],"image/gif":[]},onDrop:(e,r)=>{const t=e.filter(o=>["image/jpeg","image/png","image/jpg","image/gif"].includes(o.type));r.length>0?n("Unsupported file type. Please upload JPEG, PNG, JPG, or GIF."):n(""),j(t.map(o=>Object.assign(o,{preview:URL.createObjectURL(o)}))),t.length>0&&R(t[0])}});m.map(e=>s.jsx("div",{style:D,children:s.jsx("div",{style:N,children:s.jsx("img",{src:e.preview,style:$,onLoad:()=>{URL.revokeObjectURL(e.preview)}})})},e.name));const l=m.map(e=>e.preview);a.useEffect(()=>()=>m.forEach(e=>URL.revokeObjectURL(e.preview)),[]);const P=l.length>0?l[0]:w,E=v||P,R=async e=>{if(e){const r=new FormData;r.append("profileImage",e);try{const t=await axios.post(route("profile.upload-image"),r);g(t.data.imageUrl);const o=new CustomEvent("updateUserData");window.dispatchEvent(o),n("")}catch(t){t.response&&t.response.data&&t.response.data.message?n(t.response.data.message):n("Failed to upload image. Please try again.")}}},L=d?x():{};return a.useEffect(()=>{c===null&&console.log("Loading...")},[c]),s.jsxs("div",{className:`${I} w-full h-full rounded-full border-4 border-solid ${l.length>0?"has-image":""} ${d?"uploadable-avatar":""}`,...L,style:{backgroundImage:`url(${E})`,backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundColor:"white"},children:[d&&s.jsxs("div",{className:"avatar-overlay",children:[s.jsx("p",{className:"text-white text-center text-sm font-semibold m-auto w-[75%] hidden",children:"Drag 'n' drop some files here, or click to select files"}),s.jsx("div",{...x(),className:`dropzone uploaded-state ${l.length>0?"has-image":""}`,children:s.jsx("input",{...y()})})]}),f&&s.jsx("div",{className:"text-red-500 text-center text-sm font-bold mt-4",children:f})]})}export{_ as default};
